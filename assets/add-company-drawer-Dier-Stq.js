import{d as D,b as k,r as g,j as s}from"./index-Bsb9sFU-.js";import{D as A,a as P,b as B,c as F,d as E,e as L,f as z}from"./drawer-UxaptTl2.js";import{B as u}from"./button-IGYetEx4.js";import{I as C}from"./input-Xu_-uouI.js";import{u as O,s as T,z as x}from"./index-DZQBOct0.js";import{u as q}from"./use-fetch-CTMZA0u9.js";import{B as I}from"./BarLoader-ZAzCe0NP.js";import"./Combination-DH74FXeR.js";const M=x.object({name:x.string().min(1,"Company name is required"),logo:x.any().refine(a=>(a==null?void 0:a.length)>0,"Logo is required").refine(a=>{var t;return((t=a==null?void 0:a[0])==null?void 0:t.size)<=5e6},"Max file size is 5MB").refine(a=>{var t;return["image/jpeg","image/png","image/webp"].includes((t=a==null?void 0:a[0])==null?void 0:t.type)},"Only .jpg, .png, and .webp formats are supported")}),W=()=>{const{register:a,handleSubmit:t,formState:{errors:r,isValid:f},reset:m,setError:j}=O({resolver:T(M),mode:"onChange"}),{fn:b,loading:c}=q(D),{companies:l,setCompanies:w}=k(),[d,y]=g.useState(!1),[p,n]=g.useState({success:!1,message:""}),N=async e=>{var h;const v=(h=e.logo)==null?void 0:h[0];if(l==null?void 0:l.find(o=>o.name.toLowerCase()===e.name.toLowerCase())){j("name",{type:"manual",message:"Company already exists"}),n({success:!1,message:"Company already exists"});return}try{const o=await b({name:e.name,logo:v}),i=Array.isArray(o)?o[0]:o;i!=null&&i.id&&(w(S=>[...S,i]),n({success:!0,message:"âœ… Company added successfully!"}),m({name:"",logo:void 0}),setTimeout(()=>y(!1),1e3))}catch(o){n({success:!1,message:o.message||"Failed to add company"})}};return g.useEffect(()=>{d||(m(),n({success:!1,message:""}))},[d,m]),s.jsxs(A,{open:d,onOpenChange:y,children:[s.jsx(P,{asChild:!0,children:s.jsx(u,{type:"button",className:"w-full sm:w-auto bg-black text-white hover:bg-gray-900",onClick:e=>e.stopPropagation(),children:"Add Company"})}),s.jsxs(B,{onClick:e=>e.stopPropagation(),children:[s.jsx(F,{children:s.jsx(E,{children:"Add a New Company"})}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),t(N)(e)},className:"flex flex-col gap-4 p-4 pb-0",noValidate:!0,children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(C,{placeholder:"Company name",...a("name"),onClick:e=>e.stopPropagation()}),r.name&&s.jsx("p",{className:"text-red-500 text-sm",children:r.name.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(C,{type:"file",accept:"image/*",className:"file:text-gray-500",...a("logo"),onClick:e=>e.stopPropagation()}),r.logo&&s.jsx("p",{className:"text-red-500 text-sm",children:r.logo.message})]}),s.jsx(u,{type:"submit",variant:"destructive",className:"w-full",disabled:c||!f,onClick:e=>e.stopPropagation(),children:c?"Adding...":"Add Company"})]}),s.jsxs(L,{className:"flex flex-col gap-2",children:[c&&s.jsx(I,{className:"mb-4",width:"100%",color:"#36d7b7"}),p.message&&s.jsx("p",{className:`text-center font-medium ${p.success?"text-green-600":"text-red-500"}`,children:p.message}),s.jsx(z,{asChild:!0,children:s.jsx(u,{type:"button",variant:"secondary",onClick:e=>e.stopPropagation(),children:"Cancel"})})]})]})]})};export{W as default};
